(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("electron"),o=require("path");var n=e.n(o);const s=require("fs"),a=require("child_process"),r=require("next");var i=e.n(r);const c=require("express");var l=e.n(c);const d=(0,o.join)(t.app.getPath("userData"),"configs.json"),p=require("url"),g=require("axios");var h=e.n(g);h().defaults.proxy=!1;const u=e=>async(t,o)=>{try{const{data:t}=await h().get(e,{params:{perPage:24}});o.send(t)}catch(e){console.log(e),o.status(500).send()}},m=e=>async(t,o)=>{try{const n=await h().get(`${e}${t.params.name}`,{responseType:"stream"});o.setHeader("Content-Disposition",`attachment; filename="${t.params.name}"`),o.setHeader("Content-Type",n.headers["content-type"]),n.data.pipe(o)}catch(e){console.log(e),o.status(500).send()}},f=(0,p.fileURLToPath)("file:///home/justin/Documents/projects/personal/project-manager/electron/main.js"),y=(0,o.dirname)(f),w="development"===process.env.ELECTRON_ENV;console.log(`Development: ${w}`);const j=new class{#e={};constructor(){this.#e=(0,s.existsSync)(d)?JSON.parse((0,s.readFileSync)(d,{encoding:"utf-8"})):{}}save(e,t){this.#e[e]=t,function(e={}){(0,s.writeFileSync)(d,JSON.stringify(e),{encoding:"utf-8"})}(this.#e)}get(e,t=[]){return this.#e[e]||t}};let b;const v=()=>{const{workArea:e}=t.screen.getPrimaryDisplay(),o=new t.BrowserWindow({icon:n().join(y,"../public/logo.png"),width:1024,height:768,x:e.x+e.width-e.width/2-512,y:e.y+e.height-e.height/2-384,frame:!1,transparent:!0,fullscreen:j.get("fullscreen",!1),backgroundColor:"#18170d",webPreferences:{nodeIntegration:!1,contextIsolation:!0,enableRemoteModule:!1,preload:n().join(y,"preload.js")}});o.loadURL("http://localhost:3000"),b=o,o.on("close",(()=>{b=null})),o.on("closed",(()=>{b=null})),t.globalShortcut.register("F11",(()=>{const e=o.isFullScreen();o.setFullScreen(!e)})),w&&o.webContents.openDevTools()};t.ipcMain.on("save-config",((e,t,o)=>{if(j.save(t,o),"fullscreen"===t&&b){const e=b.isFullScreen();j.save(t,!e),b.setFullScreen(!e)}})),t.ipcMain.handle("get-config",(async(e,t,o)=>j.get(t,o))),t.ipcMain.on("run",((e,t="")=>{const o=[...t.matchAll(/\(([^)]+)\)/g)].map((e=>e[1])).filter((e=>e));var n;(0,a.spawn)((n=t,n.replace(/\([^)]*\)/g,"")).trim(),o,{detached:!0,stdio:"ignore"}).unref()})),t.ipcMain.on("bring-up",(()=>{if(b)return b.focus();v()})),t.app.whenReady().then((async()=>{const e=i()({dev:w,dir:n().join(y,"..")}),o=e.getRequestHandler();await e.prepare();const a=l()();a.get("/file/*",((e,t)=>{const o=decodeURIComponent(e.path.replace("/file","")),a=n().normalize(o);if(!(0,s.existsSync)(a))return t.status(404).send("File not found");t.download(a,n().basename(a),(e=>{e&&(console.error("Download error:",e),t.status(500).send("Error downloading file"))}))})),a.get("/config.json",((e,t)=>{if(!(0,s.existsSync)("./configs.json"))return t.status(404).send("File not found");t.download("./configs.json",n().basename("./configs.json"),(e=>{e&&(console.error("Download error:",e),t.status(500).send("Error downloading file"))}))})),a.get("/youth",u("https://ahmedalhasan.me/api/data/documents?order=desc&orderBy=updatedAt&project=title&project=latinTitle&project=description&project=image&project=type")),a.get("/youth/image/:name",m("https://ahmedalhasan.me/api/fs/files/")),a.get("/omega",u("https://omegateb.com/api/data/products")),a.get("/omega/image/:name",m("https://omegateb.com/api/fs/files/")),a.get("/ghalbedovom",u("https://ghlbedovom.com/api/data/products")),a.get("/ghalbedovom/image/:name",m("https://ghlbedovom.com/api/fs/files/")),a.all("*",((e,t)=>o(e,t))),a.listen(3e3,(()=>{console.log("> Next.js server ready on http://localhost:3000"),(()=>{const{workArea:e}=t.screen.getPrimaryDisplay();new t.BrowserWindow({icon:n().join(y,"../public/logo.png"),width:90,height:90,frame:!1,x:e.x+e.width-20,y:e.y+e.height-20,skipTaskbar:!0,transparent:!0,maxHeight:90,maxWidth:90,minHeight:90,minWidth:90,resizable:!1,alwaysOnTop:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,enableRemoteModule:!1,preload:n().join(y,"preload.js")}}).loadURL("http://localhost:3000/?type=assist")})(),v()}))}))})();