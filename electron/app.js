(()=>{"use strict";var e={n:n=>{var o=n&&n.__esModule?()=>n.default:()=>n;return e.d(o,{a:o}),o},d:(n,o)=>{for(var t in o)e.o(o,t)&&!e.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:o[t]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=require("electron"),o=require("path");var t=e.n(o);const r=require("fs"),s=require("child_process"),i=require("next");var l=e.n(i);const a=require("express");var c=e.n(a);const d=(0,o.join)(n.app.getPath("userData"),"configs.json"),p=(0,require("url").fileURLToPath)("file:///home/justin/Documents/projects/personal/project-manager/electron/main.js"),u=(0,o.dirname)(p),g="development"===process.env.ELECTRON_ENV;console.log(`Development Mode: ${g}`);const h=new class{#e={};constructor(){this.#e=(0,r.existsSync)(d)?JSON.parse((0,r.readFileSync)(d,{encoding:"utf-8"})):{}}save(e,n){this.#e[e]=n,function(e={}){(0,r.writeFileSync)(d,JSON.stringify(e),{encoding:"utf-8"})}(this.#e)}get(e,n=[]){return this.#e[e]||n}};let f;const w=()=>{const{workArea:e}=n.screen.getPrimaryDisplay(),o=new n.BrowserWindow({icon:t().join(u,"../public/logo.png"),width:1024,height:768,x:e.x+e.width-e.width/2-512,y:e.y+e.height-e.height/2-384,frame:!1,transparent:!0,fullscreen:h.get("fullscreen",!1),backgroundColor:"#18170d",webPreferences:{nodeIntegration:!1,contextIsolation:!0,enableRemoteModule:!1,preload:t().join(u,"preload.js")}});o.loadURL("http://localhost:3000"),f=o,o.on("close",(()=>{f=null})),o.on("closed",(()=>{f=null})),n.globalShortcut.register("F11",(()=>{const e=o.isFullScreen();o.setFullScreen(!e)})),g&&o.webContents.openDevTools()};n.ipcMain.on("save-config",((e,n,o)=>{if(h.save(n,o),"fullscreen"===n&&f){const e=f.isFullScreen();h.save(n,!e),f.setFullScreen(!e)}})),n.ipcMain.handle("get-config",(async(e,n,o)=>h.get(n,o))),n.ipcMain.handle("select-file",(async()=>{console.log("selecting File...");const e=await n.dialog.showOpenDialog(n.BrowserWindow.getFocusedWindow(),{properties:["openFile"]});return e.canceled?null:e.filePaths[0]})),n.ipcMain.handle("select-folder",(async()=>{const e=await n.dialog.showOpenDialog(n.BrowserWindow.getFocusedWindow(),{properties:["openDirectory"]});return e.canceled?null:e.filePaths[0]})),n.ipcMain.on("run",((e,n="")=>{const o=(e=>{const n=[];let o=0,t="";for(let r=0;r<e.length;r++){const s=e[r];"("===s?(0===o&&(t=""),o++):")"===s?(o--,0===o&&n.push(t)):o>0&&(t+=s)}return n})(n);(0,s.spawn)((e=>{let n="",o=0;for(let t=0;t<e.length;t++){const r=e[t];"("===r?o++:")"===r?o--:0===o&&(n+=r)}return n.trim()})(n).trim(),o,{detached:!0,stdio:"ignore"}).unref()})),n.ipcMain.on("bring-up",(()=>{if(f)return f.focus();w()})),n.app.whenReady().then((async()=>{const e=l()({dev:g,dir:t().join(u,"..")}),o=e.getRequestHandler();await e.prepare();const s=c()();s.get("/file/*",((e,n)=>{const o=decodeURIComponent(e.path.replace("/file","")),s=t().normalize(o);if(!(0,r.existsSync)(s))return n.status(404).send("File not found");n.download(s,t().basename(s),(e=>{e&&(console.error("Download error:",e),n.status(500).send("Error downloading file"))}))})),s.all("*",((e,n)=>o(e,n))),s.listen(3e3,(()=>{console.log("> Next.js server ready on http://localhost:3000"),(()=>{const{workArea:e}=n.screen.getPrimaryDisplay();new n.BrowserWindow({icon:t().join(u,"../public/logo.png"),width:90,height:90,frame:!1,x:e.x+e.width-20,y:e.y+e.height-20,skipTaskbar:!0,transparent:!0,maxHeight:90,maxWidth:90,minHeight:90,minWidth:90,resizable:!1,alwaysOnTop:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,enableRemoteModule:!1,preload:t().join(u,"preload.js")}}).loadURL("http://localhost:3000/?type=assist")})(),w()}))}))})();