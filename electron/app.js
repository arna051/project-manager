(()=>{"use strict";var e={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return e.d(t,{a:t}),t},d:(o,t)=>{for(var n in t)e.o(t,n)&&!e.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:t[n]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};const o=require("electron"),t=require("path");var n=e.n(t);const s=require("fs"),a=require("child_process"),r=require("next");var i=e.n(r);const l=require("express");var c=e.n(l);const d=(0,t.join)(o.app.getPath("userData"),"configs.json"),p=require("url"),g=require("axios");var h=e.n(g);h().defaults.proxy=!1;const u=e=>async(o,t)=>{try{const{data:o}=await h().get(e,{params:{perPage:24}});t.send(o)}catch(e){console.log(e),t.status(500).send()}},m=e=>async(o,t)=>{try{const n=await h().get(`${e}${o.params.name}`,{responseType:"stream"});t.setHeader("Content-Disposition",`attachment; filename="${o.params.name}"`),t.setHeader("Content-Type",n.headers["content-type"]),n.data.pipe(t)}catch(e){console.log(e),t.status(500).send()}},f=(0,p.fileURLToPath)("file:///home/justin/Documents/projects/personal/project-manager/electron/main.js"),w=(0,t.dirname)(f),y="development"===process.env.ELECTRON_ENV;console.log(`Development Mode: ${y}`);const j=new class{#e={};constructor(){this.#e=(0,s.existsSync)(d)?JSON.parse((0,s.readFileSync)(d,{encoding:"utf-8"})):{}}save(e,o){this.#e[e]=o,function(e={}){(0,s.writeFileSync)(d,JSON.stringify(e),{encoding:"utf-8"})}(this.#e)}get(e,o=[]){return this.#e[e]||o}};let b;const v=()=>{const{workArea:e}=o.screen.getPrimaryDisplay(),t=new o.BrowserWindow({icon:n().join(w,"../public/logo.png"),width:1024,height:768,x:e.x+e.width-e.width/2-512,y:e.y+e.height-e.height/2-384,frame:!1,transparent:!0,fullscreen:j.get("fullscreen",!1),backgroundColor:"#18170d",webPreferences:{nodeIntegration:!1,contextIsolation:!0,enableRemoteModule:!1,preload:n().join(w,"preload.js")}});t.loadURL("http://localhost:3000"),b=t,t.on("close",(()=>{b=null})),t.on("closed",(()=>{b=null})),o.globalShortcut.register("F11",(()=>{const e=t.isFullScreen();t.setFullScreen(!e)})),y&&t.webContents.openDevTools()};o.ipcMain.on("save-config",((e,o,t)=>{if(j.save(o,t),"fullscreen"===o&&b){const e=b.isFullScreen();j.save(o,!e),b.setFullScreen(!e)}})),o.ipcMain.handle("get-config",(async(e,o,t)=>j.get(o,t))),o.ipcMain.handle("select-file",(async()=>{console.log("selecting File...");const e=await o.dialog.showOpenDialog(o.BrowserWindow.getFocusedWindow(),{properties:["openFile"]});return e.canceled?null:e.filePaths[0]})),o.ipcMain.handle("select-folder",(async()=>{const e=await o.dialog.showOpenDialog(o.BrowserWindow.getFocusedWindow(),{properties:["openDirectory"]});return e.canceled?null:e.filePaths[0]})),o.ipcMain.on("run",((e,o="")=>{const t=(e=>{const o=[];let t=0,n="";for(let s=0;s<e.length;s++){const a=e[s];"("===a?(0===t&&(n=""),t++):")"===a?(t--,0===t&&o.push(n)):t>0&&(n+=a)}return o})(o);console.log(t),(0,a.spawn)((e=>{let o="",t=0;for(let n=0;n<e.length;n++){const s=e[n];"("===s?t++:")"===s?t--:0===t&&(o+=s)}return o.trim()})(o).trim(),t,{detached:!0,stdio:"ignore"}).unref()})),o.ipcMain.on("bring-up",(()=>{if(b)return b.focus();v()})),o.app.whenReady().then((async()=>{const e=i()({dev:y,dir:n().join(w,"..")}),t=e.getRequestHandler();await e.prepare();const a=c()();a.get("/file/*",((e,o)=>{const t=decodeURIComponent(e.path.replace("/file","")),a=n().normalize(t);if(!(0,s.existsSync)(a))return o.status(404).send("File not found");o.download(a,n().basename(a),(e=>{e&&(console.error("Download error:",e),o.status(500).send("Error downloading file"))}))})),a.get("/config.json",((e,o)=>{if(!(0,s.existsSync)("./configs.json"))return o.status(404).send("File not found");o.download("./configs.json",n().basename("./configs.json"),(e=>{e&&(console.error("Download error:",e),o.status(500).send("Error downloading file"))}))})),a.get("/youth",u("https://ahmedalhasan.me/api/data/documents?order=desc&orderBy=updatedAt&project=title&project=latinTitle&project=description&project=image&project=type")),a.get("/youth/image/:name",m("https://ahmedalhasan.me/api/fs/files/")),a.get("/omega",u("https://omegateb.com/api/data/products")),a.get("/omega/image/:name",m("https://omegateb.com/api/fs/files/")),a.get("/ghalbedovom",u("https://ghlbedovom.com/api/data/products")),a.get("/ghalbedovom/image/:name",m("https://ghlbedovom.com/api/fs/files/")),a.all("*",((e,o)=>t(e,o))),a.listen(3e3,(()=>{console.log("> Next.js server ready on http://localhost:3000"),(()=>{const{workArea:e}=o.screen.getPrimaryDisplay();new o.BrowserWindow({icon:n().join(w,"../public/logo.png"),width:90,height:90,frame:!1,x:e.x+e.width-20,y:e.y+e.height-20,skipTaskbar:!0,transparent:!0,maxHeight:90,maxWidth:90,minHeight:90,minWidth:90,resizable:!1,alwaysOnTop:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,enableRemoteModule:!1,preload:n().join(w,"preload.js")}}).loadURL("http://localhost:3000/?type=assist")})(),v()}))}))})();